Add-Type -AssemblyName System.Windows.Forms, System.Drawing

# Create the form
$form = New-Object System.Windows.Forms.Form
$form.Text = "Cardiovascular Risk Calculators"
# Adjusted form size for new layout
$form.Size = New-Object System.Drawing.Size(450, 700) 
$form.StartPosition = "CenterScreen"
$form.FormBorderStyle = "FixedSingle"
$form.MaximizeBox = $false

# --- Patient Age Input ---
$ageLabel = New-Object System.Windows.Forms.Label
$ageLabel.Text = "Patient Age:"
$ageLabel.Location = New-Object System.Drawing.Point(20, 25)
$ageLabel.AutoSize = $true
$form.Controls.Add($ageLabel)

$ageTextBox = New-Object System.Windows.Forms.TextBox
$ageTextBox.Location = New-Object System.Drawing.Point(100, 22)
$ageTextBox.Size = New-Object System.Drawing.Size(50, 20)
$form.Controls.Add($ageTextBox)

# --- CHADS-VASc section ---
$chadsvascGroup = New-Object System.Windows.Forms.GroupBox
# Repositioned group box
$chadsvascGroup.Location = New-Object System.Drawing.Point(20, 60) 
# Reduced group box height
$chadsvascGroup.Size = New-Object System.Drawing.Size(400, 230) 
$chadsvascGroup.Text = "CHADS-VASc Score"
$form.Controls.Add($chadsvascGroup)

$chfCheckbox = New-Object System.Windows.Forms.CheckBox
$chfCheckbox.Text = "CHF"
$chfCheckbox.Location = New-Object System.Drawing.Point(10, 30)
$chfCheckbox.AutoSize = $true 
$chadsvascGroup.Controls.Add($chfCheckbox)

$htnCheckbox = New-Object System.Windows.Forms.CheckBox
$htnCheckbox.Text = "Hypertension"
$htnCheckbox.Location = New-Object System.Drawing.Point(10, 55)
$htnCheckbox.AutoSize = $true
$chadsvascGroup.Controls.Add($htnCheckbox)

# Removed Age checkboxes, replaced by a single text box entry

$diabetesCheckbox = New-Object System.Windows.Forms.CheckBox
$diabetesCheckbox.Text = "Diabetes"
# Repositioned control
$diabetesCheckbox.Location = New-Object System.Drawing.Point(10, 80) 
$diabetesCheckbox.AutoSize = $true
$chadsvascGroup.Controls.Add($diabetesCheckbox)

$strokeCheckbox = New-Object System.Windows.Forms.CheckBox
$strokeCheckbox.Text = "Stroke/TIA"
# Repositioned control
$strokeCheckbox.Location = New-Object System.Drawing.Point(10, 105) 
$strokeCheckbox.AutoSize = $true
$chadsvascGroup.Controls.Add($strokeCheckbox)

$vascularCheckbox = New-Object System.Windows.Forms.CheckBox
$vascularCheckbox.Text = "Vascular Disease"
# Repositioned control
$vascularCheckbox.Location = New-Object System.Drawing.Point(10, 130) 
$vascularCheckbox.AutoSize = $true
$chadsvascGroup.Controls.Add($vascularCheckbox)

$femaleCheckbox = New-Object System.Windows.Forms.CheckBox
$femaleCheckbox.Text = "Female"
# Repositioned control
$femaleCheckbox.Location = New-Object System.Drawing.Point(10, 155) 
$femaleCheckbox.AutoSize = $true
$chadsvascGroup.Controls.Add($femaleCheckbox)


# --- HAS-BLED section ---
$hasbledGroup = New-Object System.Windows.Forms.GroupBox
# Repositioned group box
$hasbledGroup.Location = New-Object System.Drawing.Point(20, 300) 
# Reduced group box height
$hasbledGroup.Size = New-Object System.Drawing.Size(400, 250) 
$hasbledGroup.Text = "HAS-BLED Score"
$form.Controls.Add($hasbledGroup)

$htnBleedCheckbox = New-Object System.Windows.Forms.CheckBox
$htnBleedCheckbox.Text = "Uncontrolled HTN (>160 mmHg)"
$htnBleedCheckbox.Location = New-Object System.Drawing.Point(10, 30)
$htnBleedCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($htnBleedCheckbox)

$renalCheckbox = New-Object System.Windows.Forms.CheckBox
$renalCheckbox.Text = "Abnormal Renal Function"
$renalCheckbox.Location = New-Object System.Drawing.Point(10, 55)
$renalCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($renalCheckbox)

$liverCheckbox = New-Object System.Windows.Forms.CheckBox
$liverCheckbox.Text = "Abnormal Liver Function"
$liverCheckbox.Location = New-Object System.Drawing.Point(10, 80)
$liverCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($liverCheckbox)

$strokeBleedCheckbox = New-Object System.Windows.Forms.CheckBox
$strokeBleedCheckbox.Text = "Prior Stroke"
$strokeBleedCheckbox.Location = New-Object System.Drawing.Point(10, 105)
$strokeBleedCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($strokeBleedCheckbox)

# --- Checkbox Synchronization Logic ---
$htnCheckbox.Add_Click({ $htnBleedCheckbox.Checked = $htnCheckbox.Checked })
$htnBleedCheckbox.Add_Click({ $htnCheckbox.Checked = $htnBleedCheckbox.Checked })

$strokeCheckbox.Add_Click({ $strokeBleedCheckbox.Checked = $strokeCheckbox.Checked })
$strokeBleedCheckbox.Add_Click({ $strokeCheckbox.Checked = $strokeBleedCheckbox.Checked })


$bleedingHistoryCheckbox = New-Object System.Windows.Forms.CheckBox
$bleedingHistoryCheckbox.Text = "Bleeding History"
$bleedingHistoryCheckbox.Location = New-Object System.Drawing.Point(10, 130)
$bleedingHistoryCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($bleedingHistoryCheckbox)

$labileInrCheckbox = New-Object System.Windows.Forms.CheckBox
$labileInrCheckbox.Text = "Labile INR"
$labileInrCheckbox.Location = New-Object System.Drawing.Point(10, 155)
$labileInrCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($labileInrCheckbox)

# Removed Elderly checkbox

$drugsAlcoholCheckbox = New-Object System.Windows.Forms.CheckBox
$drugsAlcoholCheckbox.Text = "Drugs/Alcohol"
# Repositioned control
$drugsAlcoholCheckbox.Location = New-Object System.Drawing.Point(10, 180) 
$drugsAlcoholCheckbox.AutoSize = $true
$hasbledGroup.Controls.Add($drugsAlcoholCheckbox)


# Result label
$resultLabel = New-Object System.Windows.Forms.Label
# Repositioned label
$resultLabel.Location = New-Object System.Drawing.Point(20, 560) 
$resultLabel.Size = New-Object System.Drawing.Size(400, 40) 
$resultLabel.Text = ""
$form.Controls.Add($resultLabel)

# Calculate button
$calculateButton = New-Object System.Windows.Forms.Button
# Repositioned button
$calculateButton.Location = New-Object System.Drawing.Point(175, 610) 
$calculateButton.Size = New-Object System.Drawing.Size(100, 30)
$calculateButton.Text = "Calculate Scores"
$calculateButton.Add_Click({
    # --- Score Calculation ---
    [int]$age = 0
    [void][int]::TryParse($ageTextBox.Text, [ref]$age)

    $chadsvascScore = 0
    if ($chfCheckbox.Checked) { $chadsvascScore += 1 }
    if ($htnCheckbox.Checked) { $chadsvascScore += 1 }
    
    # Updated logic to use age from text box
    if ($age -ge 75) { 
        $chadsvascScore += 2 
    } elseif ($age -ge 65) { # Handles ages 65-74
        $chadsvascScore += 1 
    }

    if ($diabetesCheckbox.Checked) { $chadsvascScore += 1 }
    if ($strokeCheckbox.Checked) { $chadsvascScore += 2 }
    if ($vascularCheckbox.Checked) { $chadsvascScore += 1 }
    if ($femaleCheckbox.Checked) { $chadsvascScore += 1 }

    $hasbledScore = 0
    if ($htnBleedCheckbox.Checked) { $hasbledScore += 1 }
    if ($renalCheckbox.Checked) { $hasbledScore += 1 }
    if ($liverCheckbox.Checked) { $hasbledScore += 1 }
    if ($strokeBleedCheckbox.Checked) { $hasbledScore += 1 }
    if ($bleedingHistoryCheckbox.Checked) { $hasbledScore += 1 }
    if ($labileInrCheckbox.Checked) { $hasbledScore += 1 }
    
    # Updated logic to use age from text box for "Elderly" point
    if ($age -gt 65) { 
        $hasbledScore += 1 
    }

    if ($drugsAlcoholCheckbox.Checked) { $hasbledScore += 1 }

    $resultLabel.Text = "CHADS-VASc Score: $chadsvascScore`nHAS-BLED Score: $hasbledScore"
})
$form.Controls.Add($calculateButton)

# Display the form
$form.ShowDialog()

